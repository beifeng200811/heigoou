/*Obfuscated by JShaman.com*/const fs=require('fs');const path=require('path');const request=require('request');const {videoExts:videoExts,videoType:videoType,GetFileName:GetFileName,GetExt:GetExt,wildcard:wildcard}=require('./utils');const {insert:insert,insertDouYin:insertDouYin,insertGlobalVideo:insertGlobalVideo,insertSphLive:insertSphLive}=require('./db/persistent');const {insert:searchInsert}=require('./db/dySearchData');const {label:label}=require('./label');const cheerio=require('cheerio');module['exports']=(_0x2e9792,{storage:_0x349b68})=>{_0x2e9792['on']('request',(_0x2a2f4d,_0x3222fe)=>{let _0x5d352c=+_0x349b68['getProperty']('sphZb')||0x27a36^0x27a36;let _0x2f2147=+_0x349b68['getProperty']('globalVideo')||0xc059a^0xc059a;let _0x46ee10=![];const _0x1ac14b=_0x2a2f4d['originalReq'];if(_0x1ac14b['url']['indexOf']('finder.video.qq.com')>(0x5a1c1^0x5a1c1)){if(_0x1ac14b['headers']['content-type']=='video/mp4'){_0x46ee10=!![];const _0x4db756=new URL(_0x1ac14b['url']);const _0x41bbac=new URLSearchParams(_0x4db756['search']);const _0x1cec94=Object['fromEntries'](_0x41bbac['entries']());console['log']('获取到视频号的地址');console['log'](_0x1ac14b['url']);console['log'](_0x1cec94['token']);insert(_0x1ac14b['url']);}}else if(_0x1ac14b['url']['indexOf']('channels.weixin.qq.com/web/pages/feed')>(0xcab9a^0xcab9a)){_0x2a2f4d['getSession'](_0x548c46=>{if(!_0x548c46){return;}const _0x24f6ed=_0x548c46['res']['body'];console['log']('视频号返回的内容：'+_0x24f6ed);console['log']('视频号地址》》'+_0x1ac14b['url']);console['log']('=============');});}else if(_0x1ac14b['url']['indexOf']('channels.weixin.qq.com/cgi-bin/mmfinderassistant-bin/live/msg')>(0x81612^0x81612)){_0x46ee10=!![];_0x2a2f4d['getSession'](_0x2e64ec=>{if(!_0x2e64ec){return;}const _0x27ae2d=JSON['parse'](_0x2e64ec['res']['body']);if(_0x27ae2d['errCode']==(0x260e6^0x260e6)){const _0x56c258=_0x27ae2d['data'];}else{}});}else if(_0x1ac14b['url']['indexOf']('channels.weixin.qq.com/cgi-bin/mmfinderassistant-bin/live/get_live_info')>(0xc344f^0xc344f)){_0x46ee10=!![];}else if(_0x1ac14b['url']['indexOf']('www.douyin.com/video/')>(0x77e97^0x77e97)){console['log']('抖音直接访问地址');console['log'](_0x1ac14b['url']);let _0x2a22d4=_0x1ac14b['url'];_0x2a22d4=_0x2a22d4['replace']('https://www.douyin.com/video/','');if(_0x2a22d4['indexOf']('?')){_0x2a22d4=_0x2a22d4['substring'](0x3f2f4^0x3f2f4,_0x2a22d4['indexOf']('?'));}request('https://www.iesdouyin.com/web/api/v2/aweme/iteminfo/?item_ids='+_0x2a22d4,function(_0x18b8c3,_0x4ca6b4,_0x172236){console['log'](_0x172236);console['log'](_0x2a22d4+'---itemid');const _0x7f20a5=JSON['parse'](_0x172236);if(_0x4ca6b4['item_list']&&_0x4ca6b4['item_list'][0x1aa31^0x1aa31]){const _0x21225=_0x4ca6b4['item_list'][0x0];let _0x148963={'time':new Date(),'type':'douyin','desc':_0x21225['desc']};let _0x4d7fc2='';if(_0x21225['author']){_0x4d7fc2=_0x21225['author']['nickname'];}_0x148963['nickname']=_0x4d7fc2;_0x148963['statistics']=_0x21225['statistics'];_0x148963['_id']=_0x21225['aweme_id'];_0x148963['playAddr']=_0x21225['video']['play_addr'];const _0x50bb76=_0x21225['video']['play_addr']['url_list'][0x0]['replace']('playwm','play');_0x148963['url']=_0x50bb76;_0x148963['playAddr']['url_list']=[];_0x148963['playAddr']['url_list']['push'](_0x50bb76);_0x148963['playAddr']['url_list']['push'](_0x50bb76);_0x148963['playAddr']['url_list']['push'](_0x50bb76);_0x148963['cover']=_0x21225['video']['cover'];_0x148963['dynamicCover']=_0x21225['video']['dynamic_cover'];_0x148963['originCover']=_0x21225['video']['origin_cover'];_0x148963['encfilekey']=_0x21225['aweme_id'];insertDouYin(_0x148963);}});}else if(_0x1ac14b['url']['indexOf']('www.douyin.com/aweme/v1/web/search/item')>-0x1||_0x1ac14b['url']['indexOf']('www.douyin.com/aweme/v1/web/general/search/single')>-(0xd2015^0xd2014)){_0x46ee10=!![];_0x2a2f4d['getSession'](_0x108b43=>{if(!_0x108b43){return;}const _0x3c4635=_0x108b43['res']['body'];const _0x350273=JSON['parse'](_0x3c4635);const _0x218282=_0x350273['data'];console['log']('--->'+_0x218282['length']);if(_0x218282){const _0x41fafa=new URL(_0x1ac14b['url']);const _0x4b6003=new URLSearchParams(_0x41fafa['search']);const _0x4d6b3a=Object['fromEntries'](_0x4b6003['entries']());const _0x417759=_0x4d6b3a['keyword'];for(var _0x267e68=0x0;_0x267e68<_0x218282['length'];_0x267e68++){const _0xf3c2ea=_0x218282[_0x267e68];const _0x24a3e3=_0xf3c2ea['aweme_info'];if(!_0x24a3e3){console['log']('type\x20不适配\x20'+_0xf3c2ea['type']);continue;}const _0x418659=_0x24a3e3['author'];const _0x30c96d=_0x24a3e3['desc'];const _0x495fed=_0x24a3e3['aweme_id'];const _0x1b3ef5=_0x24a3e3['create_time'];const _0x5b23cf=_0x24a3e3['video'];const _0x17c39c=_0x24a3e3['statistics'];let _0x5d6e62=label(_0x30c96d);let _0x3e88ff={'keyword':_0x417759,'id':_0x495fed,'_id':_0x495fed,'vid':_0x495fed,'author':_0x418659,'desc':_0x30c96d,'create_time':_0x1b3ef5,'video':_0x5b23cf,'statistics':_0x17c39c,'collect_count':_0x17c39c['collect_count'],'comment_count':_0x17c39c['comment_count'],'digg_count':_0x17c39c['digg_count'],'share_count':_0x17c39c['share_count'],'download_count':_0x17c39c['download_count'],'share_count':_0x17c39c['share_count'],'forward_count':_0x17c39c['forward_count'],'labels':_0x5d6e62};searchInsert(_0x3e88ff);}}else{console['log']('进入到了if\x20没有书');}console['log']('=============');});}else if(_0x1ac14b['url']['indexOf']('douyin.com/aweme')>-(0x83492^0x83493)){_0x2a2f4d['getSession'](_0x455403=>{if(!_0x455403){return;}const _0x34819f=_0x455403['res']['body'];const _0x3a61f2=JSON['parse'](_0x34819f);if(_0x34819f['indexOf']('play_addr')>0x0){let _0x108f7e=_0x3a61f2['data']||_0x3a61f2['aweme_list'];console['log']('----');if(!_0x108f7e){if(_0x3a61f2['aweme_detail']){_0x108f7e=[];_0x108f7e['push'](_0x3a61f2['aweme_detail']);}}if(_0x108f7e){for(var _0x505f07=0x0;_0x505f07<_0x108f7e['length'];_0x505f07++){const _0x456251=_0x108f7e[_0x505f07];let _0x14e958={'time':new Date(),'type':'douyin','desc':_0x456251['desc']};let _0x5f1d2a='';if(_0x456251['author']){_0x5f1d2a=_0x456251['author']['nickname'];}_0x14e958['nickname']=_0x5f1d2a;_0x14e958['statistics']=_0x456251['statistics'];_0x14e958['_id']=_0x456251['aweme_id'];_0x14e958['bitRate']=_0x456251['video']['bit_rate'];_0x14e958['playAddr']=_0x456251['video']['play_addr'];_0x14e958['cover']=_0x456251['video']['cover'];_0x14e958['dynamicCover']=_0x456251['video']['dynamic_cover'];_0x14e958['originCover']=_0x456251['video']['origin_cover'];_0x14e958['url']=_0x456251['video']['play_addr']['url_list'][0x1f6e6^0x1f6e6];_0x14e958['encfilekey']=_0x456251['aweme_id'];insertDouYin(_0x14e958);}_0x46ee10=!![];}else{console['log'](_0x34819f);console['log']('没有查询到数据\x20内容为上');}}});}else if(_0x5d352c){if(_0x1ac14b['url']['indexOf']('qq.com/trtc')>(0xbe2fe^0xbe2fe)){_0x46ee10=!![];insertSphLive(_0x1ac14b['url']);}else{}}let _0x3a9644=_0x1ac14b['url'];let _0x489283='---';let _0xd512e2=new RegExp('(https?://)[^/]+([[^:blank/]]*)')['exec'](_0x3a9644);if(_0xd512e2){_0x489283=_0xd512e2[0x0]+'';_0x489283=_0x489283['replace']('https://','')['replace']('http://','');if(_0x489283['endsWith']('/')){_0x489283=_0x489283['substring'](0x0,_0x489283['length']-0x1);}}else{}const _0x3b14aa=['douyinvod.com','javadev.top'];for(var _0x4fad7b=0x0;_0x4fad7b<_0x3b14aa['length'];_0x4fad7b++){const _0xd3a8b=_0x3b14aa[_0x4fad7b];if(_0x489283['indexOf'](_0xd3a8b)>-0x1){_0x46ee10=!![];}}if(_0x2f2147&&!_0x46ee10){const _0x4c5aaf=_0x1ac14b['headers']['content-type'];let _0x266861=_0x1ac14b['headers']['content-length']||_0x1ac14b['headers']['Content-Length'];if(!_0x266861){_0x266861=_0x1ac14b['headers']['content-range']||_0x1ac14b['headers']['Content-Range'];if(_0x266861&&_0x266861['indexOf']('/')>-(0x31855^0x31854)){_0x266861=+_0x266861['substring'](_0x266861['indexOf']('/')+(0x8f265^0x8f264));}}const _0x5f745=GetFileName(_0x3a9644);const _0x494628=GetExt(_0x5f745);const _0x5a6f31=videoExts();const _0x8e2822=videoType();let _0x404701=![];for(var _0x4fad7b=0x0;_0x4fad7b<_0x5a6f31['length'];_0x4fad7b++){data_ext=_0x5a6f31[_0x4fad7b]['ext']['toLowerCase']();if(data_ext['indexOf'](_0x494628)==-(0x4bf55^0x4bf54)){continue;}else if(_0x5a6f31[_0x4fad7b]['size']==(0xdf243^0xdf243)||_0x266861>=_0x5a6f31[_0x4fad7b]['size']*(0x8d912^0x8dd12)||_0x266861==null){_0x404701=!![];break;}else{return;}}if(_0x4c5aaf!=null&&!_0x404701){for(_0x4fad7b=0x0;_0x4fad7b<_0x8e2822['length'];_0x4fad7b++){mime_Type=_0x8e2822[_0x4fad7b]['Type']['toLowerCase']();if(!wildcard(mime_Type,_0x4c5aaf)){continue;}else{_0x404701=!![];break;}}}var _0x34bdfc=_0x1ac14b['headers']['Content-Disposition'];if(_0x34bdfc){var _0x17bb60=_0x34bdfc['match'](/filename="(.*?)"/);if(_0x17bb60&&_0x17bb60[0x1]){_0x5f745=decodeURIComponent(_0x17bb60[0x1]);_0x5f745=GetFileName(_0x5f745);_0x494628=GetExt(_0x5f745);for(var _0x4fad7b=0x7483a^0x7483a;_0x4fad7b<_0x5a6f31['length'];_0x4fad7b++){data_ext=_0x5a6f31[_0x4fad7b]['ext']['toLowerCase']();if(data_ext['indexOf'](_0x494628)!=-0x1){_0x404701=!![];break;}}}}if(_0x404701){if(_0x494628!='ts'){insertGlobalVideo(_0x3a9644,_0x4c5aaf,_0x266861,_0x5f745,_0x494628);}else{}}}});};