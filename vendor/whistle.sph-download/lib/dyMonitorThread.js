/*Obfuscated by JShaman.com*/const {findAll:findAll,update:update}=require('./db/dyUserMonitor');const path=require('path');const {cookies:cookies}=require('./db/dyCookie');const {get:getConfig}=require('./appContext');const {paserVideos:paserVideos,liveWatch:liveWatch}=require('./douyinHttpUtil');const {downloadFile:downloadFile}=require('./downUtil');const {mkdirsSync:mkdirsSync}=require('./utils');const {ff_download:ff_download}=require('./ffmpegUtil');const {sendMessage:sendMessage,sendQYWXMessage:sendQYWXMessage,sendFSMessage:sendFSMessage,sendDDMessage:sendDDMessage,sendQYWXLiveMessage:sendQYWXLiveMessage,sendFSLiveMessage:sendFSLiveMessage,sendDDLiveMessage:sendDDLiveMessage}=require('./messages');exports['runDownThread']=async function runDownThread(_0xd61603){const _0x174d25=getConfig('downLoadPath');let _0x5e12a6=getConfig('user_open_id');const _0x1f2e6a=getConfig('message_qywx');const _0x372d95=getConfig('message_feishu');const _0x58ced3=getConfig('message_dingding');let _0x36b427=await findAll();const _0x2a3227=await cookies();console['log']('default\x20cookie\x20'+_0x2a3227);console['log']('需要处理的用户数量：'+_0x36b427['length']);for(var _0x5887cd=0xa140a^0xa140a;_0x5887cd<_0x36b427['length'];_0x5887cd++){let _0x302fd7=_0x36b427[_0x5887cd];const _0x5983e1=_0x302fd7['nickname'];const _0x50647f=_0x302fd7['uid'];const _0xd50502=_0x302fd7['monitored'];if(!_0xd50502){console['log']('不处理用户\x20'+_0x5983e1);continue;}console['log']('开始处理\x20'+_0x5983e1);let _0x419c8f=_0x302fd7['downHistory'];if(!_0x419c8f){_0x419c8f={};}const _0x2c1f2f=_0x302fd7['secUid'];console['log']('paserVideos\x20secUid\x20'+_0x2c1f2f);const _0x310f0b=paserVideos(_0x2c1f2f,0xd776e^0xd776e);const _0x1fd98b=_0x310f0b['aweme_list']||[];for(var _0x4e9984=0xb3be5^0xb3be5;_0x4e9984<_0x1fd98b['length'];_0x4e9984++){const _0xe556e9=_0x1fd98b[_0x4e9984];const _0x37edfa=_0xe556e9['desc'];const _0x1298eb=_0xe556e9['aweme_id'];if(_0x419c8f[_0x1298eb]){continue;}const _0x26a028=_0xe556e9['video']['play_addr']['url_list'][0xdae83^0xdae83];const _0x46b190=_0xe556e9['video']['cover']['url_list'][0xd6be6^0xd6be6];let _0x464ab2=_0x174d25;console['log']('下载路径\x20\x20'+_0x464ab2);mkdirsSync(_0x464ab2);_0x464ab2=path['join'](_0x464ab2,_0x37edfa+'.mp4');let _0x3934b1={'openid':_0x5e12a6,'vid':_0x1298eb,'desc':_0x37edfa,'url':_0x26a028,'path':_0x464ab2,'nickname':_0x5983e1,'img':_0x46b190};sendMessage(_0x3934b1);if(_0x1f2e6a){_0x3934b1['sendUrlQW']=_0x1f2e6a;sendQYWXMessage(_0x3934b1);}if(_0x372d95){_0x3934b1['sendUrlFS']=_0x372d95;sendFSMessage(_0x3934b1);}if(_0x58ced3){_0x3934b1['sendUrlDD']=_0x58ced3;sendDDMessage(_0x3934b1);}downloadFile({'url':_0x26a028,'filename':_0x464ab2,'id':_0x1298eb},function(_0x478aff){},function(_0x291e91,_0x1baab8){console['log'](_0x291e91);console['log'](_0x1baab8);console['log']('下载完成====：：nick\x20name\x20\x20'+_0x5983e1);});_0x419c8f[_0x1298eb]={'desc':_0x37edfa,'id':_0x1298eb,'fullPath':_0x464ab2};}_0x302fd7['downHistory']=_0x419c8f;await update({'id':_0x50647f,'downHistory':_0x419c8f});console['log']('开始处理直播信息');const _0x3bbdce=liveWatch(_0x2c1f2f,_0x2a3227);if(_0x3bbdce['roomId']){console['log'](_0x5983e1+'直播中：');if(_0x302fd7['roomId']==_0x3bbdce['roomId']){console['log']('已经推送过直播信息：'+_0x3bbdce['roomId']);continue;}const _0xdf9776=_0x3bbdce['roomData'];const _0x16749e=_0xdf9776['stream_url'];const _0x45e861=_0x16749e['default_resolution'];let _0xd78f73=_0x16749e['flv_pull_url'][_0x45e861];_0xd78f73=_0xd78f73['replace']('http://','https://');const _0x5a8ed7=_0xdf9776['owner']['web_rid'];await update({'id':_0x50647f,'roomId':_0x3bbdce['roomId'],'liveWebId':_0x5a8ed7});console['log']('是否字段下载：'+_0xd61603);const _0x26730c=path['join'](_0x174d25,_0x5983e1+'-'+_0x3bbdce['roomId']+'.mp4');if(_0xd61603){console['log']('自动下载：'+_0x26730c);ff_download({'id':_0x3bbdce['roomId'],'filename':_0x26730c,'url':_0xd78f73},function(_0x2a8ba8){console['log'](''+_0x2a8ba8);},function(_0x957ac3,_0x20a7c6){console['log']('close\x20'+_0x20a7c6);},function(_0x5277d8,_0x5d9030){console['log']('error\x20'+_0x5d9030);},function(_0x42eaeb,_0x5f540b){console['log']('exit\x20'+_0x5f540b);});}let _0x47a61c={'vid':_0x5a8ed7,'url':_0xd78f73,'nickname':_0x5983e1};if(_0x1f2e6a){_0x47a61c['sendUrlQW']=_0x1f2e6a;sendQYWXLiveMessage(_0x47a61c);}if(_0x372d95){_0x47a61c['sendUrlFS']=_0x372d95;sendFSLiveMessage(_0x47a61c);}if(_0x58ced3){_0x47a61c['sendUrlDD']=_0x58ced3;sendDDLiveMessage(_0x47a61c);}}else{console['log']('没直播，处理下一个');}}};